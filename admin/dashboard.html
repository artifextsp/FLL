<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FLL - Admin Dashboard</title>
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    <nav class="nav">
        <div class="container nav-list">
            <a href="dashboard.html" class="nav-link active">Dashboard</a>
            <a href="eventos.html" class="nav-link">Eventos</a>
            <a href="equipos.html" class="nav-link">Equipos</a>
            <a href="jurados.html" class="nav-link">Jurados</a>
            <a href="rubricas.html" class="nav-link">RÃºbricas</a>
            <a href="#" id="btn-logout" class="nav-link" style="margin-left: auto;">Salir</a>
        </div>
    </nav>

    <div class="container">
        <h1 class="mb-lg">Panel de AdministraciÃ³n</h1>
        
        <div class="grid grid-3">
            <a href="eventos.html" class="card" style="text-decoration: none; color: inherit; transition: transform 0.2s;">
                <h3>ğŸ“… Eventos</h3>
                <p class="text-secondary mt-sm">Gestionar torneos y fechas</p>
            </a>
            <a href="equipos.html" class="card" style="text-decoration: none; color: inherit; transition: transform 0.2s;">
                <h3>ğŸ¤– Equipos</h3>
                <p class="text-secondary mt-sm">Gestionar participantes</p>
            </a>
            <a href="jurados.html" class="card" style="text-decoration: none; color: inherit; transition: transform 0.2s;">
                <h3>ğŸ‘¨â€âš–ï¸ Jurados</h3>
                <p class="text-secondary mt-sm">Asignar jueces</p>
            </a>
        </div>
    </div>

    <script type="module">
        import { getUser, logout, getLoginUrl } from '../js/auth.js';
        
        // Esperar un momento para asegurar que localStorage estÃ© sincronizado
        (async () => {
            await new Promise(resolve => setTimeout(resolve, 50));
            
            const user = getUser();
            console.log('ğŸ” admin/dashboard - Usuario:', user);
            console.log('ğŸ” admin/dashboard - tipo_usuario:', user?.tipo_usuario);
            console.log('ğŸ” admin/dashboard - rol_activo:', user?.rol_activo);
            
            if (!user) {
                console.error('âŒ admin/dashboard - No hay usuario, redirigiendo a login');
                window.location.replace(getLoginUrl());
            } else {
                const tipoActivo = user.rol_activo || user.tipo_usuario;
                if (tipoActivo !== 'admin' && tipoActivo !== 'super_admin') {
                    console.error('âŒ admin/dashboard - Usuario no es admin:', tipoActivo);
                    alert('No tienes permisos para acceder a esta pÃ¡gina');
                    window.location.replace(getLoginUrl());
                } else {
                    console.log('âœ… admin/dashboard - Usuario autenticado como admin, mostrando dashboard');
                    document.getElementById('btn-logout').addEventListener('click', (e) => {
                        e.preventDefault();
                        logout();
                    });
                }
            }
        })();
    </script>
</body>
</html>
