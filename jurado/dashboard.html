<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FLL - Jurado Dashboard</title>
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    <nav class="nav">
        <div class="container nav-list">
            <a href="#" class="nav-link active">Dashboard</a>
            <a href="#" class="nav-link">Calificar</a>
            <a href="#" id="btn-logout" class="nav-link" style="margin-left: auto;">Salir</a>
        </div>
    </nav>

    <div class="container">
        <h1 class="mb-lg">Panel de Jurado</h1>
        
        <div class="card">
            <h2 style="margin-bottom: 12px;">Bienvenido</h2>
            <p class="mb-md">Selecciona una opci√≥n para comenzar:</p>
            <a href="calificar.html" class="btn btn-primary" style="width: 100%; display: block; text-align: center; text-decoration: none;">
                üìù Calificar Equipos
            </a>
        </div>
        
        <div class="card mt-md">
            <h3 style="margin-bottom: 8px;">Instrucciones</h3>
            <ol style="padding-left: 20px; line-height: 1.8;">
                <li>Selecciona el evento donde calificar√°s</li>
                <li>Elige la r√∫brica a aplicar</li>
                <li>Selecciona el equipo a evaluar</li>
                <li>Para cada aspecto, selecciona el nivel alcanzado</li>
                <li>Agrega observaciones si es necesario</li>
                <li>Guarda tu calificaci√≥n</li>
            </ol>
        </div>
    </div>

    <script type="module">
        import { getUser, logout, getLoginUrl } from '../js/auth.js';
        
        console.log('üìÑ jurado/dashboard.html - Script cargado');
        console.log('üìÑ jurado/dashboard.html - URL actual:', window.location.href);
        console.log('üìÑ jurado/dashboard.html - Pathname:', window.location.pathname);
        
        // Esperar un momento para asegurar que localStorage est√© sincronizado
        (async () => {
            console.log('‚è≥ jurado/dashboard - Esperando sincronizaci√≥n de localStorage...');
            await new Promise(resolve => setTimeout(resolve, 100));
            
            const user = getUser();
            console.log('üîç jurado/dashboard - Usuario obtenido:', user);
            console.log('üîç jurado/dashboard - tipo_usuario:', user?.tipo_usuario);
            console.log('üîç jurado/dashboard - rol_activo:', user?.rol_activo);
            
            if (!user) {
                console.error('‚ùå jurado/dashboard - No hay usuario, redirigiendo a login');
                const loginUrl = getLoginUrl();
                console.log('üîÑ Redirigiendo a login:', loginUrl);
                window.location.replace(loginUrl);
                return;
            }
            
            const tipoActivo = user.rol_activo || user.tipo_usuario;
            console.log('üîç jurado/dashboard - Tipo activo:', tipoActivo);
            
            if (tipoActivo !== 'jurado' && tipoActivo !== 'docente') {
                console.error('‚ùå jurado/dashboard - Usuario no es jurado:', tipoActivo);
                alert('No tienes permisos para acceder a esta p√°gina');
                const loginUrl = getLoginUrl();
                console.log('üîÑ Redirigiendo a login:', loginUrl);
                window.location.replace(loginUrl);
                return;
            }
            
            console.log('‚úÖ jurado/dashboard - Usuario autenticado correctamente, mostrando dashboard');
            document.getElementById('btn-logout').addEventListener('click', (e) => {
                e.preventDefault();
                logout();
            });
        })();
    </script>
</body>
</html>
