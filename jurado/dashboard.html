<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FLL - Jurado Dashboard</title>
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    <nav class="nav">
        <div class="container nav-list">
            <a href="#" class="nav-link active">Dashboard</a>
            <a href="#" class="nav-link">Calificar</a>
            <a href="#" id="btn-logout" class="nav-link" style="margin-left: auto;">Salir</a>
        </div>
    </nav>

    <div class="container">
        <h1 class="mb-lg">Panel de Jurado</h1>
        
        <div class="card">
            <h2 style="margin-bottom: 12px;">Bienvenido</h2>
            <p class="mb-md">Selecciona una opci√≥n para comenzar:</p>
            <a href="calificar.html" class="btn btn-primary" style="width: 100%; display: block; text-align: center; text-decoration: none;">
                üìù Calificar Equipos
            </a>
        </div>
        
        <div class="card mt-md">
            <h3 style="margin-bottom: 8px;">Instrucciones</h3>
            <ol style="padding-left: 20px; line-height: 1.8;">
                <li>Selecciona el evento donde calificar√°s</li>
                <li>Elige la r√∫brica a aplicar</li>
                <li>Selecciona el equipo a evaluar</li>
                <li>Para cada aspecto, selecciona el nivel alcanzado</li>
                <li>Agrega observaciones si es necesario</li>
                <li>Guarda tu calificaci√≥n</li>
            </ol>
        </div>
    </div>

    <script type="module">
        // ============================================
        // VERIFICACI√ìN DE AUTENTICACI√ìN SIMPLIFICADA
        // ============================================
        
        import { getUser, requireRole, logout } from '../js/auth.js';
        
        console.log('üìÑ jurado/dashboard.html - Cargando...');
        console.log('üìÑ URL actual:', window.location.href);
        
        // Verificar usuario primero para debugging
        const userCheck = getUser();
        console.log('üîç Usuario en localStorage:', userCheck);
        
        // Verificar autenticaci√≥n y rol de forma s√≠ncrona y directa
        const user = requireRole('jurado');
        
        if (user) {
            // Usuario autenticado correctamente como jurado
            console.log('‚úÖ Dashboard jurado - Usuario autenticado:', user.id, user.role);
            
            // Configurar bot√≥n de logout
            document.getElementById('btn-logout').addEventListener('click', (e) => {
                e.preventDefault();
                logout();
            });
        } else {
            console.error('‚ùå Dashboard jurado - No se pudo autenticar');
            // requireRole ya deber√≠a haber redirigido, pero por si acaso:
            setTimeout(() => {
                if (window.location.pathname.includes('jurado')) {
                    console.warn('‚ö†Ô∏è A√∫n en dashboard, forzando redirecci√≥n');
                    window.location.replace('../index.html');
                }
            }, 100);
        }
    </script>
</body>
</html>
